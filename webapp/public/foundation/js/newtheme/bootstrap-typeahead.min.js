(function(h){var w,x,s,y,z,A,B,C,D,E,F,G,H,I,e={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(b){return!b||/^\s*$/.test(b)},escapeRegExChars:function(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===typeof b},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isPlainObject,isUndefined:function(b){return"undefined"===
typeof b},bind:h.proxy,each:function(b,e){h.each(b,function(b,c){return e(c,b)})},map:h.map,filter:h.grep,every:function(b,e){var f=!0;if(!b)return f;h.each(b,function(c,a){if(!(f=e.call(null,a,c,b)))return!1});return!!f},some:function(b,e){var f=!1;if(!b)return f;h.each(b,function(c,a){if(f=e.call(null,a,c,b))return!1});return!!f},mixin:h.extend,getUniqueId:function(){var b=0;return function(){return b++}}(),templatify:function(b){function e(){return String(b)}return h.isFunction(b)?b:e},defer:function(b){setTimeout(b,
0)},debounce:function(b,e,f){var c,a;return function(){var d=this,g=arguments,l;l=f&&!c;clearTimeout(c);c=setTimeout(function(){c=null;f||(a=b.apply(d,g))},e);l&&(a=b.apply(d,g));return a}},throttle:function(b,e){var f,c,a,d,g,l;g=0;l=function(){g=new Date;a=null;d=b.apply(f,c)};return function(){var q=new Date,m=e-(q-g);f=this;c=arguments;0>=m?(clearTimeout(a),a=null,g=q,d=b.apply(f,c)):a||(a=setTimeout(l,m));return d}},noop:function(){}},J=function(b,h){function f(d){this.maxSize=d||100;this.size=
0;this.hash={};this.list=new c}function c(){this.head=this.tail=null}function a(d,g){this.key=d;this.val=g;this.prev=this.next=null}e.mixin(f.prototype,{set:function(d,g){var l=this.list.tail;this.size>=this.maxSize&&(this.list.remove(l),delete this.hash[l.key]);(l=this.hash[d])?(l.val=g,this.list.moveToFront(l)):(l=new a(d,g),this.list.add(l),this.hash[d]=l,this.size++)},get:function(d){if(d=this.hash[d])return this.list.moveToFront(d),d.val}});e.mixin(c.prototype,{add:function(d){this.head&&(d.next=
this.head,this.head.prev=d);this.head=d;this.tail=this.tail||d},remove:function(d){d.prev?d.prev.next=d.next:this.head=d.next;d.next?d.next.prev=d.prev:this.tail=d.prev},moveToFront:function(d){this.remove(d);this.add(d)}});return f}(this),M=function(){function b(a){this.prefix=["__",a,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=RegExp("^"+this.prefix)}function h(a){return JSON.stringify(e.isUndefined(a)?null:a)}var f;try{f=window.localStorage,f.setItem("~~~","!"),f.removeItem("~~~")}catch(c){f=
null}e.mixin(b.prototype,f&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){this.isExpired(a)&&this.remove(a);a=f.getItem(this._prefix(a));return JSON.parse(a)},set:function(a,d,g){e.isNumber(g)?f.setItem(this._ttlKey(a),h((new Date).getTime()+g)):f.removeItem(this._ttlKey(a));return f.setItem(this._prefix(a),h(d))},remove:function(a){f.removeItem(this._ttlKey(a));f.removeItem(this._prefix(a));return this},clear:function(){var a,
d,g=[],l=f.length;for(a=0;a<l;a++)(d=f.key(a)).match(this.keyMatcher)&&g.push(d.replace(this.keyMatcher,""));for(a=g.length;a--;)this.remove(g[a]);return this},isExpired:function(a){a=f.getItem(this._ttlKey(a));a=JSON.parse(a);return e.isNumber(a)&&(new Date).getTime()>a?!0:!1}}:{get:e.noop,set:e.noop,remove:e.noop,clear:e.noop,isExpired:e.noop});return b}(),N=function(){function b(d){d=d||{};this._send=d.transport?k(d.transport):h.ajax;this._get=d.rateLimiter?d.rateLimiter(this._get):this._get}function k(d){return function(a,
c){var b=h.Deferred();d(a,c,function(d){e.defer(function(){b.resolve(d)})},function(d){e.defer(function(){b.reject(d)})});return b}}var f=0,c={},a=6,d=new J(10);b.setMaxPendingRequests=function(d){a=d};b.resetCache=function(){d=new J(10)};e.mixin(b.prototype,{_get:function(g,l,b){function e(a){b&&b(a);d.set(g,a)}function h(){f--;delete c[g];k.onDeckRequestArgs&&(k._get.apply(k,k.onDeckRequestArgs),k.onDeckRequestArgs=null)}var k=this,r;(r=c[g])?r.done(e):f<a?(f++,c[g]=this._send(g,l).done(e).always(h)):
this.onDeckRequestArgs=[].slice.call(arguments,0)},get:function(a,c,b){var f;e.isFunction(c)&&(b=c,c={});(f=d.get(a))?e.defer(function(){b&&b(f)}):this._get(a,c,b);return!!f}});return b}(),O=function(){function b(a){a=a||{};a.datumTokenizer&&a.queryTokenizer||h.error("datumTokenizer and queryTokenizer are both required");this.datumTokenizer=a.datumTokenizer;this.queryTokenizer=a.queryTokenizer;this.datums=[];this.trie={ids:[],children:{}}}function k(a){a=e.filter(a,function(d){return!!d});return a=
e.map(a,function(d){return d.toLowerCase()})}function f(a){for(var d={},g=[],c=0;c<a.length;c++)d[a[c]]||(d[a[c]]=!0,g.push(a[c]));return g}function c(a,d){function g(d,a){return d-a}var c=0,b=0,f=[];a=a.sort(g);for(d=d.sort(g);c<a.length&&b<d.length;)a[c]<d[b]?c++:(a[c]>d[b]||(f.push(a[c]),c++),b++);return f}e.mixin(b.prototype,{bootstrap:function(a){this.datums=a.datums;this.trie=a.trie},add:function(a){var d=this;a=e.isArray(a)?a:[a];e.each(a,function(a){var c;c=d.datums.push(a)-1;a=k(d.datumTokenizer(a));
e.each(a,function(a){var g,b;g=d.trie;for(a=a.split("");b=a.shift();)g=g.children[b]||(g.children[b]={ids:[],children:{}}),g.ids.push(c)})})},get:function(a){var d=this,g;a=k(this.queryTokenizer(a));e.each(a,function(a){var b,f;if(g&&0===g.length)return!1;b=d.trie;for(a=a.split("");b&&(f=a.shift());)b=b.children[f];if(b&&0===a.length)b=b.ids.slice(0),g=g?c(g,b):b;else return g=[],!1});return g?e.map(f(g),function(a){return d.datums[a]}):[]},serialize:function(){return{datums:this.datums,trie:this.trie}}});
return b}(),u=function(){return{local:function(b){b=b.local||null;e.isFunction(b)&&(b=b.call(null));return b},prefetch:function(b){var k;k={url:null,thumbprint:"",ttl:864E5,filter:null,ajax:{}};if(b=b.prefetch||null)b=e.isString(b)?{url:b}:b,b=e.mixin(k,b),b.thumbprint="0.10.1"+b.thumbprint,b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",!b.url&&h.error("prefetch requires url to be set");return b},remote:function(b){function k(a){return function(d){return e.debounce(d,a)}}function f(a){return function(d){return e.throttle(d,
a)}}var c;c={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}};if(b=b.remote||null)b=e.isString(b)?{url:b}:b,b=e.mixin(c,b),b.rateLimiter=/^throttle$/i.test(b.rateLimitBy)?f(b.rateLimitWait):k(b.rateLimitWait),b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",delete b.rateLimitBy,delete b.rateLimitWait,!b.url&&h.error("remote requires url to be set");return b}}}();window.Bloodhound=function(){function b(c){c&&(c.local||
c.prefetch||c.remote)||h.error("one of local, prefetch, or remote is required");this.limit=c.limit||5;this.sorter=k(c.sorter);this.dupDetector=c.dupDetector||f;this.local=u.local(c);this.prefetch=u.prefetch(c);this.remote=u.remote(c);this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null;this.index=new O({datumTokenizer:c.datumTokenizer,queryTokenizer:c.queryTokenizer});this.storage=this.cacheKey?new M(this.cacheKey):null}function k(c){function a(d){return d.sort(c)}function d(d){return d}
return e.isFunction(c)?a:d}function f(){return!1}b.tokenizers={whitespace:function(c){return c.split(/\s+/)},nonword:function(c){return c.split(/\W+/)}};e.mixin(b.prototype,{_loadPrefetch:function(c){function a(a){a=c.filter?c.filter(a):a;d.add(a);d._saveToStorage(d.index.serialize(),c.thumbprint,c.ttl)}var d=this,g;(g=this._readFromStorage(c.thumbprint))?(this.index.bootstrap(g),g=h.Deferred().resolve()):g=h.ajax(c.url,c.ajax).done(a);return g},_getFromRemote:function(c,a){var d=this,g;c=c||"";g=
encodeURIComponent(c);g=this.remote.replace?this.remote.replace(this.remote.url,c):this.remote.url.replace(this.remote.wildcard,g);return this.transport.get(g,this.remote.ajax,function(g){g=d.remote.filter?d.remote.filter(g):g;a(g)})},_saveToStorage:function(c,a,d){this.storage&&(this.storage.set("data",c,d),this.storage.set("protocol",location.protocol,d),this.storage.set("thumbprint",a,d))},_readFromStorage:function(c){var a,d,g;this.storage&&(a=this.storage.get("data"),d=this.storage.get("protocol"),
g=this.storage.get("thumbprint"));c=g!==c||d!==location.protocol;return a&&!c?a:null},initialize:function(){function c(){a.add(a.local)}var a=this,d;d=this.prefetch?this._loadPrefetch(this.prefetch):h.Deferred().resolve();this.local&&d.done(c);this.transport=this.remote?new N(this.remote):null;this.initialize=function(){return d.promise()};return d.promise()},add:function(c){this.index.add(c)},get:function(c,a){function d(d){var c=b.slice(0);e.each(d,function(d){!e.some(c,function(a){return g.dupDetector(d,
a)})&&c.push(d);return c.length<g.limit});a&&a(g.sorter(c))}var g=this,b,f=!1;b=this.index.get(c);b=this.sorter(b).slice(0,this.limit);b.length<this.limit&&this.transport&&(f=this._getFromRemote(c,d));!f&&a&&a(b)},ttAdapter:function(){return e.bind(this.get,this)}});return b}();E='<span class="twitter-typeahead"></span>';F='<span class="tt-dropdown-menu"></span>';G='<div class="tt-dataset-%CLASS%"></div>';H='<span class="tt-suggestions"></span>';I='<div class="tt-suggestion">%BODY%</div>';w={position:"relative",
display:"inline-block"};x={position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"};s={position:"relative",verticalAlign:"top",backgroundColor:"transparent"};y={position:"relative",verticalAlign:"top"};z={position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"};A={display:"block"};B={whiteSpace:"normal"};C={left:"0",right:"auto"};D={left:"auto",right:" 0"};e.isMsie()&&e.mixin(s,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});
e.isMsie()&&7>=e.isMsie()&&e.mixin(s,{marginTop:"-1px"});var K=function(){function b(b){b&&b.el||h.error("EventBus initialized without el");this.$el=h(b.el)}e.mixin(b.prototype,{trigger:function(b){var f=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+b,f)}});return b}(),v=function(){function b(d,a,b,e){if(!b)return this;a=a.split(c);b=e?f(b,e):b;for(this._callbacks=this._callbacks||{};e=a.shift();)this._callbacks[e]=this._callbacks[e]||{sync:[],async:[]},this._callbacks[e][d].push(b);return this}
function e(d,a,c){return function(){for(var b,f=0;!b&&f<d.length;f+=1)b=!1===d[f].apply(a,c);return!b}}function f(d,a){return d.bind?d.bind(a):function(){d.apply(a,[].slice.call(arguments,0))}}var c=/\s+/,a=function(){return window.setImmediate?function(d){setImmediate(function(){d()})}:function(d){setTimeout(function(){d()},0)}}();return{onSync:function(d,a,c){return b.call(this,"sync",d,a,c)},onAsync:function(d,a,c){return b.call(this,"async",d,a,c)},off:function(d){var a;if(!this._callbacks)return this;
for(d=d.split(c);a=d.shift();)delete this._callbacks[a];return this},trigger:function(d){var g,b,f,h,p;if(!this._callbacks)return this;d=d.split(c);for(f=[].slice.call(arguments,1);(g=d.shift())&&(b=this._callbacks[g]);)h=e(b.sync,this,[g].concat(f)),p=e(b.async,this,[g].concat(f)),h()&&a(p);return this}}}(),P=function(b){function h(c,a,d){for(var g=[],b=0;b<c.length;b++)g.push(e.escapeRegExChars(c[b]));c=d?"\\b("+g.join("|")+")\\b":"("+g.join("|")+")";return a?RegExp(c):RegExp(c,"i")}var f={node:null,
pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(c){function a(d){var a,f;if(a=g.exec(d.data))wrapperNode=b.createElement(c.tagName),c.className&&(wrapperNode.className=c.className),f=d.splitText(a.index),f.splitText(a[0].length),wrapperNode.appendChild(f.cloneNode(!0)),d.parentNode.replaceChild(wrapperNode,f);return!!a}function d(a,b){for(var c,g=0;g<a.childNodes.length;g++)c=a.childNodes[g],3===c.nodeType?g+=b(c)?1:0:d(c,b)}var g;c=e.mixin({},f,c);c.node&&
c.pattern&&(c.pattern=e.isArray(c.pattern)?c.pattern:[c.pattern],g=h(c.pattern,c.caseSensitive,c.wordsOnly),d(c.node,a))}}(window.document),L=function(){function b(a){var d=this,g,b,f,m;a=a||{};a.input||h.error("input is missing");g=e.bind(this._onBlur,this);b=e.bind(this._onFocus,this);f=e.bind(this._onKeydown,this);m=e.bind(this._onInput,this);this.$hint=h(a.hint);this.$input=h(a.input).on("blur.tt",g).on("focus.tt",b).on("keydown.tt",f);0===this.$hint.length&&(this.setHintValue=this.getHintValue=
this.clearHint=e.noop);if(e.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){c[a.which||a.keyCode]||e.defer(e.bind(d._onInput,d,a))});else this.$input.on("input.tt",m);this.query=this.$input.val();this.$overflowHelper=k(this.$input)}function k(a){return h('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"nowrap",fontFamily:a.css("font-family"),fontSize:a.css("font-size"),fontStyle:a.css("font-style"),fontVariant:a.css("font-variant"),
fontWeight:a.css("font-weight"),wordSpacing:a.css("word-spacing"),letterSpacing:a.css("letter-spacing"),textIndent:a.css("text-indent"),textRendering:a.css("text-rendering"),textTransform:a.css("text-transform")}).insertAfter(a)}function f(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey}var c;c={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};b.normalizeQuery=function(a){return(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")};e.mixin(b.prototype,v,{_onBlur:function(a){this.resetInputValue();
this.trigger("blurred")},_onFocus:function(a){this.trigger("focused")},_onKeydown:function(a){var d=c[a.which||a.keyCode];this._managePreventDefault(d,a);d&&this._shouldTrigger(d,a)&&this.trigger(d+"Keyed",a)},_onInput:function(a){this._checkInputValue()},_managePreventDefault:function(a,d){var b,c;switch(a){case "tab":b=this.getHintValue();c=this.getInputValue();b=b&&b!==c&&!f(d);break;case "up":case "down":b=!f(d);break;default:b=!1}b&&d.preventDefault()},_shouldTrigger:function(a,d){var b;switch(a){case "tab":b=
!f(d);break;default:b=!0}return b},_checkInputValue:function(){var a,d,c;a=this.getInputValue();d=this.query;c=(d=b.normalizeQuery(a)===b.normalizeQuery(d))?this.query.length!==a.length:!1;d?c&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query=a)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,
d){this.$input.val(a);!d&&this._checkInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(a){this.$hint.val(a)},resetInputValue:function(){this.$input.val(this.query)},clearHint:function(){this.$hint.val("")},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var a=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a,
d;a=this.$input.val().length;d=this.$input[0].selectionStart;return e.isNumber(d)?d===a:document.selection?(d=document.selection.createRange(),d.moveStart("character",-a),a===d.text.length):!0},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null}});return b}(),t=function(){function b(a){a=a||{};a.templates=a.templates||{};a.source||h.error("missing source");a.name&&!/^[_a-zA-Z0-9-]+$/.test(a.name)&&h.error("invalid dataset name: "+a.name);
this.query=null;this.highlight=!!a.highlight;this.name=a.name||e.getUniqueId();this.source=a.source;this.displayFn=k(a.display||a.displayKey);this.templates=f(a.templates,this.displayFn);this.$el=h(G.replace("%CLASS%",this.name))}function k(a){function d(b){return b[a]}a=a||"value";return e.isFunction(a)?a:d}function f(a,d){function b(a){return"<p>"+d(a)+"</p>"}return{empty:a.empty&&e.templatify(a.empty),header:a.header&&e.templatify(a.header),footer:a.footer&&e.templatify(a.footer),suggestion:a.suggestion||
b}}var c="ttDataset",a="ttValue",d="ttDatum";b.extractDatasetName=function(a){return h(a).data(c)};b.extractValue=function(d){return h(d).data(a)};b.extractDatum=function(a){return h(a).data(d)};e.mixin(b.prototype,v,{_render:function(b,f){function k(){var q,m;q=h(H).css(A);m=e.map(f,function(b){var f;f=n.templates.suggestion(b);f=I.replace("%BODY%",f);b=h(f).data(c,n.name).data(a,n.displayFn(b)).data(d,b);b.children().each(function(){h(this).css(B)});return b});q.append.apply(q,m);n.highlight&&P({node:q[0],
pattern:b});return q}function m(){return n.templates.header({query:b,isEmpty:!r})}function p(){return n.templates.footer({query:b,isEmpty:!r})}if(this.$el){var n=this,r;this.$el.empty();r=f&&f.length;!r&&this.templates.empty?this.$el.html(n.templates.empty({query:b,isEmpty:!0})).prepend(n.templates.header?m():null).append(n.templates.footer?p():null):r&&this.$el.html(k()).prepend(n.templates.header?m():null).append(n.templates.footer?p():null);this.trigger("rendered")}},getRoot:function(){return this.$el},
update:function(a){var d=this;this.query=a;this.source(a,function(b){a===d.query&&d._render(a,b)})},clear:function(){this._render(this.query||"")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}});return b}(),Q=function(){function b(b){var c=this,a,d,g;b=b||{};b.menu||h.error("menu is required");this.isOpen=!1;this.isEmpty=!0;this.datasets=e.map(b.datasets,k);a=e.bind(this._onSuggestionClick,this);d=e.bind(this._onSuggestionMouseEnter,this);g=e.bind(this._onSuggestionMouseLeave,
this);this.$menu=h(b.menu).on("click.tt",".tt-suggestion",a).on("mouseenter.tt",".tt-suggestion",d).on("mouseleave.tt",".tt-suggestion",g);e.each(this.datasets,function(a){c.$menu.append(a.getRoot());a.onSync("rendered",c._onRendered,c)})}function k(b){return new t(b)}e.mixin(b.prototype,v,{_onSuggestionClick:function(b){this.trigger("suggestionClicked",h(b.currentTarget))},_onSuggestionMouseEnter:function(b){this._removeCursor();this._setCursor(h(b.currentTarget),!0)},_onSuggestionMouseLeave:function(b){this._removeCursor()},
_onRendered:function(){(this.isEmpty=e.every(this.datasets,function(b){return b.isEmpty()}))?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(b,c){b.first().addClass("tt-cursor");!c&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},
_moveCursor:function(b){var c,a;this.isOpen&&(a=this._getCursor(),c=this._getSuggestions(),this._removeCursor(),b=c.index(a)+b,b=(b+1)%(c.length+1)-1,-1===b?this.trigger("cursorRemoved"):(-1>b&&(b=c.length-1),this._setCursor(c=c.eq(b)),this._ensureVisible(c)))},_ensureVisible:function(b){var c,a,d;c=b.position().top;b=c+b.outerHeight(!0);a=this.$menu.scrollTop();d=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);0>c?this.$menu.scrollTop(a+
c):d<b&&this.$menu.scrollTop(a+(b-d))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(b){this.$menu.css("ltr"===b?C:D)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(b){var c=null;b.length&&(c={raw:t.extractDatum(b),value:t.extractValue(b),
datasetName:t.extractDatasetName(b)});return c},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(b){e.each(this.datasets,function(c){c.update(b)})},empty:function(){e.each(this.datasets,function(b){b.clear()});this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){this.$menu.off(".tt");this.$menu=null;
e.each(this.datasets,function(b){b.destroy()})}});return b}(),R=function(){function b(a){var b,c,f;a=a||{};a.input||h.error("missing input");this.autoselect=!!a.autoselect;this.minLength=e.isNumber(a.minLength)?a.minLength:1;this.$node=k(a.input,a.withHint);b=this.$node.find(".tt-dropdown-menu");c=this.$node.find(".tt-input");f=this.$node.find(".tt-hint");this.eventBus=a.eventBus||new K({el:c});this.dropdown=(new Q({menu:b,datasets:a.datasets})).onSync("suggestionClicked",this._onSuggestionClicked,
this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=(new L({input:c,hint:f})).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,
this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this);b.on("mousedown.tt",function(a){e.isMsie()&&9>e.isMsie()&&(c[0].onbeforedeactivate=function(){window.event.returnValue=!1;c[0].onbeforedeactivate=null});a.preventDefault()})}function k(b,c){var e,k,m,p;e=h(b);k=h(E).css(w);m=h(F).css(z);p=e.clone().css(x).css(f(e));
p.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled",!0).attr({autocomplete:"off",spellcheck:"false"});e.data(a,{dir:e.attr("dir"),autocomplete:e.attr("autocomplete"),spellcheck:e.attr("spellcheck"),style:e.attr("style")});e.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(c?s:y);try{!e.attr("dir")&&e.attr("dir","auto")}catch(n){}return e.wrap(k).parent().prepend(c?p:null).append(m)}function f(a){return{backgroundAttachment:a.css("background-attachment"),
backgroundClip:a.css("background-clip"),backgroundColor:a.css("background-color"),backgroundImage:a.css("background-image"),backgroundOrigin:a.css("background-origin"),backgroundPosition:a.css("background-position"),backgroundRepeat:a.css("background-repeat"),backgroundSize:a.css("background-size")}}function c(b){var c=b.find(".tt-input");e.each(c.data(a),function(a,b){e.isUndefined(a)?c.removeAttr(b):c.attr(b,a)});c.detach().removeData(a).removeClass("tt-input").insertAfter(b);b.remove()}var a="ttAttrs";
e.mixin(b.prototype,{_onSuggestionClicked:function(a,b){var c;(c=this.dropdown.getDatumForSuggestion(b))&&this._select(c)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.clearHint();this.input.setInputValue(a.value,!0);this.eventBus.trigger("cursorchanged",a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint();this.eventBus.trigger("opened")},
_onClosed:function(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function(){this.dropdown.empty();this.dropdown.open()},_onBlurred:function(){this.dropdown.close()},_onEnterKeyed:function(a,b){var c,e;c=this.dropdown.getDatumForCursor();e=this.dropdown.getDatumForTopSuggestion();c?(this._select(c),b.preventDefault()):this.autoselect&&e&&(this._select(e),b.preventDefault())},_onTabKeyed:function(a,b){var c;(c=this.dropdown.getDatumForCursor())?(this._select(c),b.preventDefault()):
this._autocomplete()},_onEscKeyed:function(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function(){var a=this.input.getQuery();!this.dropdown.isOpen&&a.length>=this.minLength&&this.dropdown.update(a);this.dropdown.open();this.dropdown.moveCursorUp()},_onDownKeyed:function(){var a=this.input.getQuery();!this.dropdown.isOpen&&a.length>=this.minLength&&this.dropdown.update(a);this.dropdown.open();this.dropdown.moveCursorDown()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},
_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,b){this.input.clearHint();this.dropdown.empty();b.length>=this.minLength&&this.dropdown.update(b);this.dropdown.open();this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},_updateHint:function(){var a,
b,c;(a=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()&&(b=this.input.getInputValue(),c=L.normalizeQuery(b),c=e.escapeRegExChars(c),c=RegExp("^(?:"+c+")(.*$)","i"),a=c.exec(a.value),this.input.setHintValue(b+(a?a[1]:"")))},_autocomplete:function(){var a,b;a=this.input.getHintValue();b=this.input.getQuery();a&&b!==a&&this.input.isCursorAtEnd()&&((a=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(a.value),this.eventBus.trigger("autocompleted",
a.raw,a.datasetName))},_select:function(a){this.input.clearHint();this.input.setQuery(a.value);this.input.setInputValue(a.value,!0);this._setLanguageDirection();this.eventBus.trigger("selected",a.raw,a.datasetName);this.dropdown.close();e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},getQuery:function(){return this.input.getQuery()},setQuery:function(a){this.input.setInputValue(a)},destroy:function(){this.input.destroy();
this.dropdown.destroy();c(this.$node);this.$node=null}});return b}();(function(){var b,k,f;b=h.fn.typeahead;k="ttTypeahead";f={initialize:function(b,a){a=e.isArray(a)?a:[].slice.call(arguments,1);b=b||{};return this.each(function(){var d=h(this),f;e.each(a,function(a){a.highlight=!!b.highlight});f=new R({input:d,eventBus:new K({el:d}),withHint:e.isUndefined(b.hint)?!0:!!b.hint,minLength:b.minLength,autoselect:b.autoselect,datasets:a});d.data(k,f)})},open:function(){return this.each(function(){var b;
(b=h(this).data(k))&&b.open()})},close:function(){return this.each(function(){var b;(b=h(this).data(k))&&b.close()})},val:function(b){function a(){var a;(a=h(this).data(k))&&a.setQuery(b)}function d(a){var b;if(a=a.data(k))b=a.getQuery();return b}return arguments.length?this.each(a):d(this.first())},destroy:function(){return this.each(function(){var b=h(this),a;if(a=b.data(k))a.destroy(),b.removeData(k)})}};h.fn.typeahead=function(b){return f[b]?f[b].apply(this,[].slice.call(arguments,1)):f.initialize.apply(this,
arguments)};h.fn.typeahead.noConflict=function(){h.fn.typeahead=b;return this}})()})(window.jQuery);